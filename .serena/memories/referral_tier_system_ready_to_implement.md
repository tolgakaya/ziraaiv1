# Referral Tier System - Ready for Implementation

**Date**: 2025-10-02
**Branch**: feature/referrer-tier-system
**Status**: üü° DESIGN COMPLETE - READY TO IMPLEMENT

---

## Quick Reference

**Design Document**: `claudedocs/referral-tier-system-design.md` (1,800+ lines)
**Messaging Infrastructure**: ‚úÖ READY (`unified_messaging_system_implementation.md`)

---

## User Requirements (Verbatim)

### Core Features
- ‚úÖ **Configurable Rewards**: "Her referral = +10 analiz hakkƒ± (sƒ±nƒ±rsƒ±z birikim) **BURADAKƒ∞ 10 RAKAMI KONFƒ∞G√úRATƒ∞F OLMALI**"
- ‚úÖ **Hybrid Delivery**: "D) Hybrid: Hem SMS hem WhatsApp se√ßeneƒüi **ASIL BUNU YAPALIM**"
- ‚úÖ **Deep Linking**: "Lƒ∞NK YAPISININ Bƒ∞R √ñNEMƒ∞ YOK AMA G√ñNDERƒ∞LEN Lƒ∞NK ƒ∞LE KULLANICI REGƒ∞STER OLMADIƒûI ƒ∞√áƒ∞N PLAYSTOREDAN UYGULAMA A√áILACAK VE ONUN REFERRAL KODU ƒ∞LE REGƒ∞STER OLACAK"
- ‚úÖ **Validation**: "C) Referral ge√ßerli olmasƒ± i√ßin yeni kullanƒ±cƒ± en az 1 analiz yapmalƒ± **BU OLMALI**"
- ‚úÖ **Link Expiry**: "30 g√ºn (WhatsApp/SMS link expiry standart) **BU OLSUN !!!**"
- ‚úÖ **Credit Visibility**: "HAYIR, Hƒ∞√á GEREK YOK, AMA REFERRAL ƒ∞LE HESAPLARINA Y√úKLENMƒ∞≈û KULLANIMHAKLARINI G√ñREBƒ∞LSƒ∞NLER"

---

## System Overview

### Referral Flow
```
User A generates referral link
    ‚Üì
Link sent via SMS + WhatsApp (Hybrid)
    ‚Üì
User B clicks: https://ziraai.com/ref/ZIRA-ABC123
    ‚Üì
Backend tracks click
    ‚Üì
Redirect to Play Store with referrer=ZIRA-ABC123
    ‚Üì
User B installs app
    ‚Üì
App captures referrer parameter
    ‚Üì
User B registers with phone + referral code
    ‚Üì
User B completes 1st analysis ‚Üí VALIDATION GATE
    ‚Üì
Referrer (User A) receives configurable credits (default: 10)
    ‚Üì
Credits visible in GET /api/v1/subscription/usage
```

---

## Database Schema (4 New Tables)

### 1. ReferralCodes
```sql
CREATE TABLE public."ReferralCodes" (
    "Id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "UserId" INTEGER NOT NULL,
    "Code" VARCHAR(20) NOT NULL UNIQUE,  -- e.g., "ZIRA-ABC123"
    "IsActive" BOOLEAN NOT NULL DEFAULT TRUE,
    "CreatedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "ExpiresAt" TIMESTAMP NOT NULL,  -- CreatedAt + 30 days
    "Status" INTEGER NOT NULL DEFAULT 0,  -- 0=Active, 1=Expired, 2=Disabled

    CONSTRAINT "FK_ReferralCodes_Users"
        FOREIGN KEY ("UserId") REFERENCES public."Users"("UserId") ON DELETE CASCADE
);

CREATE INDEX "IX_ReferralCodes_UserId" ON public."ReferralCodes"("UserId");
CREATE INDEX "IX_ReferralCodes_Code" ON public."ReferralCodes"("Code");
CREATE INDEX "IX_ReferralCodes_ExpiresAt" ON public."ReferralCodes"("ExpiresAt");
```

**Code Format**: `ZIRA-ABC123` (prefix configurable, 6 alphanumeric without confusing chars)

### 2. ReferralTracking
```sql
CREATE TABLE public."ReferralTracking" (
    "Id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "ReferralCodeId" INTEGER NOT NULL,
    "RefereeUserId" INTEGER NULL,
    "ClickedAt" TIMESTAMP NULL,
    "RegisteredAt" TIMESTAMP NULL,
    "FirstAnalysisAt" TIMESTAMP NULL,
    "RewardProcessedAt" TIMESTAMP NULL,
    "Status" INTEGER NOT NULL DEFAULT 0,  -- 0=Clicked, 1=Registered, 2=Validated, 3=Rewarded
    "RefereeMobilePhone" VARCHAR(15) NULL,
    "IpAddress" VARCHAR(45) NULL,
    "DeviceId" VARCHAR(255) NULL,
    "FailureReason" TEXT NULL,

    CONSTRAINT "FK_ReferralTracking_ReferralCodes"
        FOREIGN KEY ("ReferralCodeId") REFERENCES public."ReferralCodes"("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_ReferralTracking_Users"
        FOREIGN KEY ("RefereeUserId") REFERENCES public."Users"("UserId") ON DELETE SET NULL
);

CREATE INDEX "IX_ReferralTracking_ReferralCodeId" ON public."ReferralTracking"("ReferralCodeId");
CREATE INDEX "IX_ReferralTracking_Status" ON public."ReferralTracking"("Status");
```

**Status Flow**: Clicked (0) ‚Üí Registered (1) ‚Üí Validated (2) ‚Üí Rewarded (3)

### 3. ReferralRewards
```sql
CREATE TABLE public."ReferralRewards" (
    "Id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "ReferralTrackingId" INTEGER NOT NULL,
    "ReferrerUserId" INTEGER NOT NULL,
    "RefereeUserId" INTEGER NOT NULL,
    "CreditAmount" INTEGER NOT NULL,  -- Configurable (default: 10)
    "AwardedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "SubscriptionId" INTEGER NULL,
    "ExpiresAt" TIMESTAMP NULL,

    CONSTRAINT "FK_ReferralRewards_ReferralTracking"
        FOREIGN KEY ("ReferralTrackingId") REFERENCES public."ReferralTracking"("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_ReferralRewards_ReferrerUsers"
        FOREIGN KEY ("ReferrerUserId") REFERENCES public."Users"("UserId") ON DELETE CASCADE,
    CONSTRAINT "FK_ReferralRewards_RefereeUsers"
        FOREIGN KEY ("RefereeUserId") REFERENCES public."Users"("UserId") ON DELETE CASCADE,
    CONSTRAINT "FK_ReferralRewards_Subscriptions"
        FOREIGN KEY ("SubscriptionId") REFERENCES public."Subscriptions"("Id") ON DELETE SET NULL
);

CREATE INDEX "IX_ReferralRewards_ReferrerUserId" ON public."ReferralRewards"("ReferrerUserId");
```

### 4. ReferralConfigurations
```sql
CREATE TABLE public."ReferralConfigurations" (
    "Id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "Key" VARCHAR(100) NOT NULL UNIQUE,
    "Value" TEXT NOT NULL,
    "Description" TEXT NULL,
    "DataType" VARCHAR(20) NOT NULL DEFAULT 'string',
    "UpdatedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "UpdatedBy" INTEGER NULL,

    CONSTRAINT "FK_ReferralConfigurations_Users"
        FOREIGN KEY ("UpdatedBy") REFERENCES public."Users"("UserId") ON DELETE SET NULL
);

CREATE UNIQUE INDEX "IX_ReferralConfigurations_Key" ON public."ReferralConfigurations"("Key");

-- Default configurations
INSERT INTO public."ReferralConfigurations" ("Key", "Value", "Description", "DataType") VALUES
('Referral.CreditPerReferral', '10', 'Number of analysis credits awarded per successful referral', 'int'),
('Referral.LinkExpiryDays', '30', 'Number of days before referral link expires', 'int'),
('Referral.MinAnalysisForValidation', '1', 'Minimum number of analyses new user must complete', 'int'),
('Referral.MaxReferralsPerUser', '0', 'Maximum referrals per user (0 = unlimited)', 'int'),
('Referral.EnableWhatsApp', 'true', 'Enable WhatsApp link sharing', 'bool'),
('Referral.EnableSMS', 'true', 'Enable SMS link sharing', 'bool'),
('Referral.CodePrefix', 'ZIRA', 'Prefix for referral codes', 'string'),
('Referral.DeepLinkBaseUrl', 'https://ziraai.com/ref/', 'Base URL for referral deep links', 'string');
```

### Modified Tables

#### Subscriptions Table
```sql
ALTER TABLE public."Subscriptions"
    ADD COLUMN "ReferralCredits" INTEGER NOT NULL DEFAULT 0;

COMMENT ON COLUMN public."Subscriptions"."ReferralCredits" IS
    'Analysis credits earned through referrals, separate from subscription quota';
```

#### Users Table
```sql
ALTER TABLE public."Users"
    ADD COLUMN "RegistrationReferralCode" VARCHAR(20) NULL;

CREATE INDEX "IX_Users_RegistrationReferralCode"
    ON public."Users"("RegistrationReferralCode");
```

---

## API Endpoints (6 Total)

### 1. Generate Referral Link
**Endpoint**: `POST /api/v1/referral/generate-link`
**Auth**: Required
**Rate Limit**: 10 requests/hour

**Request**:
```json
{
  "deliveryMethod": "Both",  // "SMS" | "WhatsApp" | "Both"
  "recipientPhoneNumbers": ["05321234567", "05339876543"],
  "customMessage": "Optional custom message"
}
```

**Response**:
```json
{
  "success": true,
  "data": {
    "referralCode": "ZIRA-ABC123",
    "deepLink": "https://ziraai.com/ref/ZIRA-ABC123",
    "playStoreLink": "https://play.google.com/...",
    "expiresAt": "2025-11-01T12:00:00Z",
    "deliveryStatus": [
      { "phoneNumber": "05321234567", "method": "SMS", "status": "Sent" },
      { "phoneNumber": "05321234567", "method": "WhatsApp", "status": "Sent" }
    ]
  }
}
```

### 2. Get Referral Statistics
**Endpoint**: `GET /api/v1/referral/stats`
**Auth**: Required

**Response**:
```json
{
  "success": true,
  "data": {
    "totalReferrals": 15,
    "successfulReferrals": 12,
    "pendingReferrals": 3,
    "totalCreditsEarned": 120,
    "referralBreakdown": {
      "clicked": 25,
      "registered": 15,
      "validated": 12,
      "rewarded": 12
    }
  }
}
```

### 3. Track Referral Click
**Endpoint**: `POST /api/v1/referral/track-click`
**Auth**: Not required (public)
**Rate Limit**: 100/hour per IP

### 4. Validate Referral Code
**Endpoint**: `POST /api/v1/referral/validate-code`
**Auth**: Not required (during registration)

### 5. Process Referral Reward
**Endpoint**: `POST /api/v1/referral/process-reward`
**Auth**: Internal service token
**Called By**: PlantAnalysisWorkerService after 1st analysis

### 6. Get User Usage (Modified)
**Endpoint**: `GET /api/v1/subscription/usage`
**Auth**: Required

**Response**:
```json
{
  "success": true,
  "data": {
    "subscriptionTier": "Trial",
    "subscriptionCredits": 5,
    "referralCredits": 30,  // ‚Üê NEW
    "totalAvailableCredits": 35,
    "referralCreditBreakdown": {  // ‚Üê NEW
      "totalEarned": 120,
      "totalUsed": 90,
      "currentBalance": 30
    }
  }
}
```

---

## Core Services (5 Total)

### 1. ReferralCodeService
**File**: `Business/Services/Referral/ReferralCodeService.cs`

**Methods**:
- `GenerateUniqueCode(string prefix)` - Creates ZIRA-XXXXXX codes
- `CreateReferralCodeAsync(int userId)` - Creates code with 30-day expiry
- `ValidateCodeAsync(string code)` - Checks if code is active and not expired

**Code Generation**:
```csharp
// Format: ZIRA-ABC123
// Allowed chars: ABCDEFGHJKLMNPQRSTUVWXYZ23456789 (no confusing chars)
// Length: 11 characters (ZIRA + - + 6 alphanumeric)
// Collision detection with max 10 retry attempts
```

### 2. ReferralLinkService
**File**: `Business/Services/Referral/ReferralLinkService.cs`

**Methods**:
- `GenerateAndSendLinksAsync(userId, phones, method)` - Full workflow
- `BuildPlayStoreLink(code)` - Creates Play Store URL with referrer
- `SendMessagesAsync(phones, code, link, method)` - Hybrid SMS + WhatsApp

**Messaging Integration**:
```csharp
// Uses IMessagingServiceFactory from unified messaging system
var smsService = _factory.GetSmsService();
var whatsappService = _factory.GetWhatsAppService();

// Hybrid delivery (user requirement!)
if (method == Both)
{
    await smsService.SendSmsAsync(phone, smsMessage);
    await whatsappService.SendMessageAsync(phone, whatsappMessage);
}
```

### 3. ReferralTrackingService
**File**: `Business/Services/Referral/ReferralTrackingService.cs`

**Methods**:
- `TrackClickAsync(code, context)` - Records link clicks
- `LinkRegistrationAsync(userId, code)` - Links registration to referral
- `ValidateReferralAsync(userId)` - Triggers after 1st analysis (VALIDATION GATE)

**Anti-Abuse**:
- Duplicate click prevention (device-based)
- Self-referral prevention
- IP address tracking

### 4. ReferralRewardService
**File**: `Business/Services/Referral/ReferralRewardService.cs`

**Methods**:
- `ProcessRewardAsync(referrerId, refereeId, trackingId)` - Awards credits
- `GetTotalReferralCreditsAsync(userId)` - Current balance
- `DeductReferralCreditAsync(userId)` - Used when creating analysis

**Credit Allocation**:
```csharp
// Get configurable amount
var creditAmount = await _configService.GetCreditsPerReferralAsync();  // Default: 10

// Add to subscription
subscription.ReferralCredits += creditAmount;

// Create reward record
var reward = new ReferralReward
{
    ReferrerUserId = referrerId,
    RefereeUserId = refereeId,
    CreditAmount = creditAmount,
    AwardedAt = DateTime.Now
};
```

### 5. ReferralConfigurationService
**File**: `Business/Services/Referral/ReferralConfigurationService.cs`

**Methods**:
- `GetCreditsPerReferralAsync()` - **CONFIGURABLE REWARD AMOUNT** ‚ú®
- `GetLinkExpiryDaysAsync()` - 30 days
- `GetMinAnalysisForValidationAsync()` - 1 analysis
- `UpdateConfigurationAsync(key, value, updatedBy)` - Admin control

**Caching**: 15-minute TTL for performance

---

## Integration Points

### 1. Phone Authentication (Modified)
**File**: `Business/Handlers/Authorizations/Commands/RegisterUserWithPhoneCommand.cs`

```csharp
public async Task<IResult> Handle(RegisterUserWithPhoneCommand request, ...)
{
    // Create user
    var user = new User
    {
        MobilePhones = normalizedPhone,
        FullName = request.FullName,
        RegistrationReferralCode = request.ReferralCode  // ‚Üê NEW
    };

    await _userRepository.AddAsync(user);

    // Link referral if provided
    if (!string.IsNullOrEmpty(request.ReferralCode))
    {
        await _referralService.LinkRegistrationAsync(user.UserId, request.ReferralCode);
    }

    return new SuccessResult();
}
```

### 2. Plant Analysis (Modified)
**File**: `Business/Handlers/PlantAnalysisRequests/Commands/CreatePlantAnalysisRequestCommand.cs`

```csharp
public async Task<IResult> Handle(CreatePlantAnalysisRequestCommand request, ...)
{
    // Create analysis
    var analysis = new PlantAnalysisRequest { ... };
    await _analysisRepo.AddAsync(analysis);

    // Check if first analysis
    var analysisCount = await _analysisRepo.Query()
        .Where(a => a.UserId == userId)
        .CountAsync();

    if (analysisCount == 1)  // ‚Üê VALIDATION GATE
    {
        await _referralService.ValidateReferralAsync(userId);
    }

    return new SuccessResult();
}
```

### 3. Subscription Usage (Modified)
**File**: `Business/Handlers/Subscriptions/Queries/GetUserSubscriptionUsageQuery.cs`

```csharp
public async Task<IDataResult<SubscriptionUsageDto>> Handle(...)
{
    var subscription = await _subscriptionRepo.GetActiveSubscriptionAsync(userId);

    // Get referral credits
    var referralCredits = await _referralService.GetTotalReferralCreditsAsync(userId);

    var dto = new SubscriptionUsageDto
    {
        SubscriptionCredits = subscription.DailyRequestLimit - subscription.DailyUsage,
        ReferralCredits = referralCredits,  // ‚Üê NEW
        TotalAvailableCredits = (subscription.DailyRequestLimit - subscription.DailyUsage) + referralCredits,
        ReferralCreditBreakdown = new ReferralCreditBreakdownDto  // ‚Üê NEW
        {
            TotalEarned = totalEarned,
            TotalUsed = totalUsed,
            CurrentBalance = referralCredits
        }
    };

    return new SuccessDataResult<SubscriptionUsageDto>(dto);
}
```

### 4. Credit Usage Priority
**File**: `Business/Services/Subscription/SubscriptionValidationService.cs`

```csharp
public async Task<bool> ValidateAndDecrementUsageAsync(int userId)
{
    var subscription = await GetActiveSubscriptionAsync(userId);

    // PRIORITY: Use referral credits first, then subscription quota
    if (subscription.ReferralCredits > 0)
    {
        await _referralRewardService.DeductReferralCreditAsync(userId);
        _logger.LogInformation("Used referral credit for user {UserId}", userId);
        return true;
    }

    if (subscription.DailyUsage < subscription.DailyRequestLimit)
    {
        subscription.DailyUsage++;
        await _subscriptionRepo.UpdateAsync(subscription);
        _logger.LogInformation("Used subscription quota for user {UserId}", userId);
        return true;
    }

    throw new BusinessException("No available credits or quota");
}
```

---

## SMS/WhatsApp Message Templates

### SMS Template (Turkish)
```
üå± ZiraAI'ye ho≈ü geldin!

{ReferrerName} seni davet ediyor.
Bitki analizi i√ßin uygulamayƒ± indir:

{PlayStoreLink}

Kod: {ReferralCode}
Son kullanma: {ExpiryDate}
```

### WhatsApp Template (Turkish)
```
üå± *ZiraAI - Bitki Analizi*

Merhaba! {ReferrerName} seni ZiraAI'ye davet etti.

Yapay zeka ile bitkilerini √ºcretsiz analiz et:
{PlayStoreLink}

üì± Referans Kodu: *{ReferralCode}*
‚è∞ Son Kullanma: {ExpiryDate}

_Kayƒ±t olurken bu kodu kullan!_
```

---

## Implementation Roadmap (7 Weeks)

### Phase 1: Core Infrastructure (Week 1)
- [ ] Create database migration script (4 tables + 2 modifications)
- [ ] Create entity classes with EF configurations
- [ ] Create repository interfaces and implementations
- [ ] Register in DI container
- [ ] Insert default configurations
- [ ] Run migration on dev database

### Phase 2: Business Logic (Week 2)
- [ ] Implement ReferralCodeService
- [ ] Implement ReferralLinkService (with messaging integration)
- [ ] Implement ReferralTrackingService
- [ ] Implement ReferralRewardService
- [ ] Implement ReferralConfigurationService
- [ ] Write unit tests (90% coverage target)

### Phase 3: API Endpoints (Week 3)
- [ ] Create ReferralController with 5 endpoints
- [ ] Create CQRS commands/queries/handlers
- [ ] Add FluentValidation rules
- [ ] Create DTOs
- [ ] Create ReferralConfigController (admin)
- [ ] Update AuthController (add referral code to registration)

### Phase 4: Integration & Testing (Week 4)
- [ ] Modify RegisterUserWithPhoneCommand
- [ ] Modify CreatePlantAnalysisRequestCommand (1st analysis detection)
- [ ] Modify GetUserSubscriptionUsageQuery (show referral credits)
- [ ] Modify SubscriptionValidationService (credit priority)
- [ ] Create ReferralRedirectController (web handler)
- [ ] E2E testing (complete flow)

### Phase 5: Mobile App Integration (Week 5)
- [ ] Flutter: Add Play Install Referrer library
- [ ] Flutter: Create ReferralService
- [ ] Flutter: Modify registration screen
- [ ] Flutter: Test deep linking
- [ ] Test complete flow: Link ‚Üí Play Store ‚Üí App ‚Üí Register ‚Üí Analysis ‚Üí Reward

### Phase 6: Monitoring & Analytics (Week 6)
- [ ] Add structured logging
- [ ] Implement metrics tracking
- [ ] Create admin dashboard (optional)
- [ ] Setup alerts

### Phase 7: Production Deployment (Week 7)
- [ ] Staging deployment & testing
- [ ] Production database migration
- [ ] Production deployment
- [ ] Monitoring setup
- [ ] Documentation updates

---

## Security & Anti-Abuse

### Implemented Measures
1. **Self-Referral Prevention**: Cannot use own referral code
2. **Duplicate Click Prevention**: Device-based tracking
3. **Rate Limiting**: 10 links/hour per user
4. **Secure Code Generation**: Cryptographically secure random
5. **Phone Masking**: API responses mask phone numbers
6. **Validation Gate**: 1 analysis required before reward

### Code Examples

**Self-Referral Prevention**:
```csharp
if (code.UserId == userId)
    throw new BusinessException("Cannot use your own referral code");
```

**Duplicate Prevention**:
```csharp
var existingTracking = await _trackingRepo.Query()
    .Where(t => t.ReferralCodeId == code.Id && t.DeviceId == deviceId)
    .FirstOrDefaultAsync();

if (existingTracking != null)
{
    _logger.LogWarning("Duplicate click from device {DeviceId}", deviceId);
    return;  // Don't create duplicate
}
```

---

## Testing Strategy

### Unit Tests
- ReferralCodeService: Code generation, uniqueness, expiry
- ReferralTrackingService: Click tracking, registration linking, validation
- ReferralRewardService: Credit allocation, deduction, balance tracking
- Anti-abuse scenarios: Self-referral, duplicates

### Integration Tests
- Complete referral flow: Generate ‚Üí Send ‚Üí Click ‚Üí Register ‚Üí Analyze ‚Üí Reward
- Configuration changes take effect
- Credit usage priority (referral ‚Üí subscription)

### E2E Test Scenarios
1. **Happy Path**: Full flow with reward
2. **Expired Link**: 31-day old link fails
3. **Self-Referral**: System prevents
4. **Credit Usage**: Referral credits used first

---

## Configuration Reference

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `Referral.CreditPerReferral` | int | 10 | **CONFIGURABLE REWARD AMOUNT** ‚ú® |
| `Referral.LinkExpiryDays` | int | 30 | Link expiry (user req: 30 days) |
| `Referral.MinAnalysisForValidation` | int | 1 | Validation gate (user req: 1 analysis) |
| `Referral.MaxReferralsPerUser` | int | 0 | Max referrals (0 = unlimited) |
| `Referral.EnableWhatsApp` | bool | true | Hybrid delivery |
| `Referral.EnableSMS` | bool | true | Hybrid delivery |
| `Referral.CodePrefix` | string | "ZIRA" | Code format |
| `Referral.DeepLinkBaseUrl` | string | "https://ziraai.com/ref/" | Base URL |

---

## Next Session Action Items

**Immediate Start**: Phase 1 - Database Schema

1. Create migration script: `DataAccess/Migrations/Pg/Manual/add_referral_system.sql`
2. Create entity classes in `Entities/Concrete/`
3. Create repositories in `DataAccess/`
4. Register in `AutofacBusinessModule.cs`
5. Test migration on dev database

**Branch**: feature/referrer-tier-system (already created)
**Documentation**: `claudedocs/referral-tier-system-design.md` (complete)
**Messaging System**: ‚úÖ Ready to use

---

## Success Criteria

- [ ] All 4 tables created successfully
- [ ] Default configurations inserted
- [ ] Entity classes with EF configurations
- [ ] Repositories registered in DI
- [ ] Migration runs without errors
- [ ] Build successful

---

**READY TO IMPLEMENT!** üöÄ
